<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://unpkg.com/vue@2.7.8/dist/vue.js"></script>
  <script src="product.js"></script>
  <title> Lessons Store App</title>
</head>

<body>
  <div id="app">
    <header>
      <h1 v-text="sitename"></h1>
      <button v-on:click="showCheckout">
        {{ totalLessonsInTheCart }}
        <span class="fa-solid fa-cart-shopping"></span>
        Checkout
      </button>
    </header>

    <div v-if="showProduct">
      <main>
        <div v-for="product in sortedProducts">

          <h1 v-text="'Subject: ' + product.subject"></h1>

          <figure>
            <img v-bind:src="product.image" style="width: 150px; height: auto;">
          </figure>

          <h3 v-text="'Location: ' + product.location"></h3>
          <h3>Price: Â£{{product.price}}</h3>
          <h3>Spaces: {{product.availableSpace}}</h3>

          <button v-if="canAddToCart(product)" v-on:click="addLessonsToTheCart(product)">Add to
             Cart</button>
          <button v-else disabled>Add to the Cart</button>

          <span v-if="itemsLeft(product) === 0"> Sold out ! </span>
          <span v-else-if="itemsLeft(product) < 5"> Only {{itemsLeft(product)}} left </span>
          <span v-else> Buy now </span>


        </div>
      </main>
    </div>


    <div v-else>
      <h1>Welcome to the Checkout page</h1>

      <p>
        <strong>Name: </strong>
        <input type="text" v-model.trim="order.name">
      </p>

      <p>
        <strong>Phone: </strong>
        <input type="text" v-model.trim="order.phone">
      </p>

      <h2> Order Reciept </h2>
      <p>
        <strong>Name: </strong> {{order.name}}
      </p>
      <p>
        <strong>phone: </strong> {{order.phone}}
      </p>

      <button v-on:click="submitCheckoutForm">Place Order</button>


    </div>

  </div>
  <script>
    let webstore = new Vue({
      el: "#app",
      data: {
        sitename: "Lessons Store App",
        showProduct: true,
        products: products,
        cart: [],

        order: {
          name: "",
          phone: "",
        }
      },
      methods: {
        showCheckout: function () {
          if (this.showProduct) {
            this.showProduct = false;
          } else {
            this.showProduct = true;
          }
        },
        addLessonsToTheCart: function (product) {
          this.cart.push(product.id);
        },
        submitCheckoutForm() {
          alert(" Order Submitted ")
        },
        canAddToCart(product) {
          return product.availableSpace > this.cartCount(product.id);
        },
        cartCount(id) {
          let count = 0;
          for (let i = 0; i < this.cart.length; i++) {
            if (this.cart[i] === id) {
              count++;
            }
          }
          return count;
        },
        itemsLeft(product) {
          return product.availableSpace - this.cartCount(product.id);
        }
      },
      computed: {
        
        
        totalLessonsInTheCart: function () {  // shows the number of lessons in the cart or shows nothing 
          return this.cart.length || "";
        },

        sortedProducts(){                     // price sorting function from acending to decending
            function compare(a,b){             
              if (a.price > b.price) return -1
              if (a.price > b.price) return 1
              return 0;
            }
            return this.products.sort(compare);
        }
      }
    })
  </script>
</body>
</html>